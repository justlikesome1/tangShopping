<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	
		<link href="/TangShopping/css/bootstrap.css"  type="text/css" rel="stylesheet"/>
        <style type="text/css">
             body{
             	background-color: #EEEEEE;
             }
        
        	#carousel-example-generic img{
        		margin: 0 auto;
        	}
        	
        	#carousel-example-generic{
        		
        		margin-top: 0px;
        	}
     
        </style>
	</head>
	<body>
		<!--导航条，在顶部固定-->
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			 <!--导航条的头部-->
			 <div class="navbar-header">
			 	<a class="navbar-brand" >
			 		<img alt="" src="/TangShopping/front/upload/shizi.jpg" weight="50" height = "37" >
			 		
			 	</a>
			 	<!-- 缩小之后的按钮 -->
			 	 <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				      <span class="sr-only">Toggle navigation</span>
				      <span class="icon-bar"></span>
				      <span class="icon-bar"></span>
				      <span class="icon-bar"></span>
    			</button>
			 </div>
			
			
			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			  	<ul class="nav navbar-nav navbar-right">
			  		<li><a href="#" id="login"><span class="glyphicon glyphicon-user"></span><span id="login_info">登录</span></a></li>
			  		<li><a href="#"><span class="glyphicon glyphicon-gift"></span>注册</a></li>
					<li><a href="#"><span class="glyphicon glyphicon-shopping-cart"></span><span id="shopping_cart">购物车</span><span class="badge">13</span></a></li>
					<li><a href="#"><span class="glyphicon glyphicon-list"></span>个人资料</a></li>
					 <li><a href="#"><span class="glyphicon glyphicon-off"></span><span id="cus_exit">退出登录</span></a></li>
	
				</ul>
			  </div>
			
		</nav>
		<!-- 搜索框 -->
	<div  style="background-color: orangered;margin-top: 50px;padding: 10px;">
			<div class="input-group" style="width: 60%;margin: 0px auto;">
				  <input type="text" class="form-control" placeholder="请输入商品名称" id="goods_name_txt">
				  <span class="input-group-addon" style="cursor: pointer" id="goods_search_btn">查询</span>
			</div>
	 
	</div>


    <!--轮播图-->
    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
		  <!-- 轮播图上的序号 -->
		  <ol class="carousel-indicators">
		    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
		    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
		    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
		  </ol>
		
		  <!-- 设置滑动的图片-->
		  <div class="carousel-inner">
		    <div class="item active">
		      <img src="/TangShopping/front/upload/u=172164176,3438157092&fm=26&gp=0.jpg" alt="..." height="400px">
		    </div>
		    
		    
		    
		     <div class="item">
		      <img src="/TangShopping/front/upload/u=1775563490,643946028&fm=26&gp=0.jpg" alt="..." height="400px">
		    </div>
		    
		    <div class="item">
		      <img src="/TangShopping/front/upload/u=1749054789,2181032107&fm=11&gp=0.jpg" alt="..." height="400px">
		    </div>
		  </div>
		
		  <!-- 控制图片滑动额左右箭头 -->
		  <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
		    <span class="glyphicon glyphicon-chevron-left"></span>
		  </a>
		  <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
		    <span class="glyphicon glyphicon-chevron-right"></span>
		  </a>
		</div>
          
          <!--使用bootstrap栅格系统-->
		  
		 <div class="container" style="margin-top: 10px;">
		  	 <div class="row" id="goods">
		  	     
		 	</div>
		 	
		 				<ul class="pagination pull-right" id="pages">
						
						</ul>
		</div>
		

<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">登录</h4>
      </div>
      <div class="modal-body">
        				<form class="form-horizontal" action="user.do" method="post" id="login_form" name="login_form"> 
							<div class="form-group">
								<label class="col-md-4 col-sm-4 control-label">用户名：</label>
								<div class="col-md-6 ">
									<input type="text" class="form-control"  required="required" name="cusName" />
								
								</div>
							</div>
							<div class="form-group">
								<label class="col-md-4 col-sm-4 control-label">密码：</label>
								<div class="col-md-6 ">
									<input type="password" class="form-control"  required="required" name="cusPwd">
								
								</div>
							</div>
						
						
					
							
						</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" id="login_btn" form="login_form">登录</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<script src="/TangShopping/js/jquery-1.12.3.min.js" type="text/javascript"></script>
<script src="/TangShopping/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript">
	
$("#login").click(function(){
	if($("#login_info").html()=="登录"){
		//展示模态框
		$("#myModal").modal();
	}
	return false;
});
	//给登录按钮添加点击事件
	$("#login_btn").click(function(){
		$.ajax({
			cache:false,
			type:"POST",
			url:"../../login.do",
			data:$("#login_form").serialize(),
			async:true,
			error:function(){
				alert("error");
			},
			success:function(data){
				if (data == "true") {
					$("#login_info").html($(":text[name=cusName]").val()+"已登录");
					//关闭模态框
					$("#myModal").modal("hide");
				}else {
					alert("登陆失败,请重新登录");
				}
			}
		})
	});
		
	//调用加载数据的函数
	loadData(1,"");
	/*加载页面中药显示所有的数据*/
	function loadData(curentPage,goodsNameParam){
		$.ajax({
			cache:false,
			type:"POST",
			url:"../../getAllOfHtml.do",
			data:{"cutPage":curentPage,"goodsName":goodsNameParam},
			dataType:"json",
			async:true,
			error:function(){
				alert("加载时");
			},
			success:function(data){
				
				//加载商品信息
				var goodsList = data.pageBean.data;
				var str = "";
				for (var i = 0; i < goodsList.length; i++) {
					str=str+"<div class=\"col-sm-6 col-md-4 col-xs-12 col-lg-3\">";
		    		str=str+"<div class= thumbnail >";
		    		str=str+"<img src= '../../"+goodsList[i].goodsImg+"'  style=\"width: 100%;height: 200px\">";
		    		str=str+"<div class= caption>"; 
		    		str=str+"<h4>"+goodsList[i].goodsName+"</h4>";
		    		str=str+"<h5 style=\"color: red\">价格：<span>"+goodsList[i].goodsPrice+"</span></h5>";
		    		str=str+"<p>库存量:<span>"+goodsList[i].goodsCount+"</span></p>";
							
		    		str=str+"<p>";
		    		str=str+"<button class=\"btn btn-danger\">购买</button>";
		    		str=str+"&nbsp;&nbsp;&nbsp;&nbsp;";
		    		str=str+"<button class=\"btn btn-success\" name= add_shop_btn  title= "+goodsList[i].goodsId+">加入购物车</button>";
		    		str=str+"</p>";
		    		str=str+"</div></div></div>";
				}
				$("#goods").html(str);
				//加载时分页信息
				var pageStr = "<li><a href= "+(data.pageBean.currentPage-1)+">&laquo;</a></li>";
			  	  
			  	  for(var i=1;i<=data.pageBean.pages;i++){
			  		if(i==data.pageBean.currentPage){  
			  		  pageStr=pageStr+"<li class= active><a href= "+i+">"+i+"</a></li>";
			  		}
			  		else{
			  		 pageStr=pageStr+"<li ><a href= "+i+">"+i+"</a></li>";
			  		}
			  		  
			  	  }
				
			
			  	  pageStr=pageStr+"<li><a href= "+(data.pageBean.currentPage+1)+">&raquo;</a></li>";
			  	
			  	  $("#pages").html(pageStr);
			  	  
			  	  pageClick();
			  	  
			  	  //加载用户名
			  	  var cusName = data.cusName;
			  	loadName(cusName);
			  	
			  	  //给购物车添加单击事件
			  	click_shopping_cart();
			  	  
			  	  //给加入购物车加单击事件
			  	  add_shop_click();
			  	  
			  	  
			  	  //退出登录按钮
			  	  click_cus_exit();
				
			}
		});
		
	}
	
	function loadName(cusName){
		if (cusName != undefined) {
			$("#login_info").html(cusName + "已经登录");
		}else {
			$("#login_info").html("登录");
		}
		
	}
	
	
	
	
	//分页按钮
	function pageClick() {
		$("#pages li a").click(function(){
			//得到正在点击的a的href属性值
			var currentPage = $(this).attr("href");
			
			//得到查询条件
			var goodsName = $("#goods_name_text").val();
			loadData(currentPage,goodsName)
			
			return false;
		});
		
	}
	
	//调用单击查询按钮的函数
	clickGoodsSerach();
	
	//给查询按钮添加单击事件
	function clickGoodsSerach(){
		
		$("#goods_search_btn").click(function(){
			var goodsName = $("#goods_name_txt").val();
			
			loadData(1,goodsName);
		});
		
	}
	
	
	//给添加到购物车添加点击事件
	function add_shop_click(){
		
		$(":button[name = add_shop_btn]").click(function(){
			
			if ($("#login_info").html() == "登录") {
				$("#myModal").modal();
			}else {
				//得到商品id
				var goodsId = $(this).attr("title");
				
				$.ajax({
					cache:false,
					type:"POST",
					url:"../../addShopping.do",
					data:{"goodsId":goodsId},
					async:true,
					error:function(){
						alert("请先登录");
					},
					success:function(data){
					}
				});
			}
		});
	}
	
	//给购物车添加单击事件
	function click_shopping_cart() {
	$("#shopping_cart").click(function(){
		
		if ($("#login_info").html() == "登录") {
			$("#myModal").modal();
		}else {
			location.href="shoppings.html";
		}
	});
	}
	
	//退出按钮
	function click_cus_exit() {
		$("#cus_exit").click(function() {
			if (confirm("您确定要退出吗？")) {
				
				$.ajax({
					cache:false,
					type:"POST",
					url:"../../indexExit.do",
					async:false,
					error:function(){
						alert("退出失败");
					},
					success:function(){
						top.location.href = "/TangShopping/front/html/index.html";
					}
				});
				
			}
		return false;
		});
	}



</script>
</body>
</html>